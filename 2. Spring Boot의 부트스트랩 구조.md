# ğŸ§  Spring Bootì˜ ë¶€íŠ¸ìŠ¤íŠ¸ë© êµ¬ì¡° ì™„ì „ ë¶„ì„: `@SpringBootApplication`ê³¼ `SpringApplication.run()`ì˜ ë‚´ë¶€ ë©”ì»¤ë‹ˆì¦˜

---

## 1ï¸âƒ£ `@SpringBootApplication`ì˜ ì—­í• 

```java
@SpringBootApplication
public class MyApp {
    public static void main(String[] args) {
        SpringApplication.run(MyApp.class, args);
    }
}
```

### ğŸ” `@SpringBootApplication` = 3ê°€ì§€ ì• ë„ˆí…Œì´ì…˜ ì¡°í•©

```java
@Target(...)
@Retention(...)
@Documented
@Inherited
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan
public @interface SpringBootApplication {
    ...
}
```

#### ì„¤ëª…:

* `@SpringBootConfiguration`: `@Configuration`ì˜ í™•ì¥ â€” Bean ì •ì˜ë¥¼ í¬í•¨í•˜ëŠ” êµ¬ì„± í´ë˜ìŠ¤ì„ì„ ë‚˜íƒ€ëƒ„.
* `@EnableAutoConfiguration`: `spring.factories`ì˜ `EnableAutoConfiguration` í•­ëª©ì„ ê¸°ë°˜ìœ¼ë¡œ ìë™ êµ¬ì„± ìˆ˜í–‰.
* `@ComponentScan`: í˜„ì¬ íŒ¨í‚¤ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  `@Component` ìŠ¤ìº”í•˜ì—¬ ë¹ˆ ë“±ë¡.

> ì¦‰, ì´ í•˜ë‚˜ì˜ ì• ë„ˆí…Œì´ì…˜ì´ **Spring ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ë™ì— í•„ìš”í•œ ìµœì†Œí•œì˜ êµ¬ì„±**ì„ ëª¨ë‘ í•´ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

---

## 2ï¸âƒ£ `SpringApplication.run()` ë™ì‘ íë¦„ ì „ì²´ ìš”ì•½

```java
SpringApplication.run(MyApp.class, args);
```

### ë‚´ë¶€ ë™ì‘ ìˆœì„œ ê°œìš”:

1. `SpringApplication` ê°ì²´ ìƒì„±
2. ì´ˆê¸°í™” ì‘ì—… (`ApplicationContextInitializer`, `ApplicationListener`, `mainApplicationClass` íƒìƒ‰ ë“±)
3. í™˜ê²½(Environment) ìƒì„± ë° ì„¤ì •
4. `ApplicationContext` ìƒì„±
5. `ApplicationContextInitializer` ì‹¤í–‰
6. `ApplicationListener` ë“±ë¡
7. `@Bean`, `@Configuration`, `@Component` ìŠ¤ìº” ë° ë“±ë¡
8. `CommandLineRunner` / `ApplicationRunner` ì‹¤í–‰

---

## 3ï¸âƒ£ ì†ŒìŠ¤ì½”ë“œ ë¶„ì„: `SpringApplication.run()`

### ğŸ“ ì§„ì…ì 

```java
public static ConfigurableApplicationContext run(Class<?> primarySource, String... args) {
    return new SpringApplication(primarySource).run(args);
}
```

### ğŸ“ SpringApplication ìƒì„±ì

```java
public SpringApplication(Class<?>... primarySources) {
    this();
    setPrimarySources(Arrays.asList(primarySources));
    this.webApplicationType = WebApplicationType.deduceFromClasspath();
}
```

* `primarySources`: ë³´í†µ `@SpringBootApplication`ì´ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ ê°€ë¦¬í‚´.
* `WebApplicationType`: ì„œë¸”ë¦¿ ê¸°ë°˜ (Tomcat), REACTIVE(Netty), NONE ë“±ì„ ìë™ ê°ì§€.

---

### ğŸ“ run(String... args)

```java
public ConfigurableApplicationContext run(String... args) {
    StopWatch stopWatch = new StopWatch();
    stopWatch.start();

    // 1. ì´ˆê¸°í™” ì¤€ë¹„
    DefaultBootstrapContext bootstrapContext = createBootstrapContext();
    ConfigurableApplicationContext context = null;

    // 2. ApplicationListeners ì‹¤í–‰ (spring.factories ê¸°ë°˜)
    SpringApplicationRunListeners listeners = getRunListeners(args);
    listeners.starting(bootstrapContext, this.mainApplicationClass);

    try {
        // 3. í™˜ê²½(Environment) ìƒì„± ë° ë°”ì¸ë”©
        ConfigurableEnvironment environment = prepareEnvironment(listeners, bootstrapContext, args);

        // 4. ë°°ë„ˆ ì¶œë ¥
        Banner printedBanner = printBanner(environment);

        // 5. ApplicationContext ìƒì„± (ë””í´íŠ¸ëŠ” AnnotationConfigServletWebServerApplicationContext)
        context = createApplicationContext();

        // 6. ApplicationContextInitializer ì‹¤í–‰
        prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);

        // 7. ë¦¬í”„ë ˆì‹œ (refresh() í˜¸ì¶œ)
        refreshContext(context);

        // 8. Runnerë“¤ ì‹¤í–‰
        afterRefresh(context, applicationArguments);

        listeners.running(context);
        stopWatch.stop();

        return context;
    }
    catch (Throwable ex) {
        handleRunFailure(context, ex, listeners);
        throw new IllegalStateException(ex);
    }
}
```

---

## 4ï¸âƒ£ ì£¼ìš” ë©”ì„œë“œ ë‚´ë¶€ ìƒì„¸ ë¶„ì„

---

### ğŸ” `prepareEnvironment()`

```java
ConfigurableEnvironment environment = new StandardServletEnvironment();
configureEnvironment(environment, args);
bindToSpringApplication(environment);
```

* `application.properties`, `application.yml`, ì‹œìŠ¤í…œ ì†ì„±, ì»¤ë§¨ë“œë¼ì¸ ì¸ìë¥¼ ì½ì–´ Springì˜ `Environment` ê°ì²´ì— ë°”ì¸ë”©.
* ì´ ë‹¨ê³„ì—ì„œ **í”„ë¡œíŒŒì¼ í™œì„±í™”**, `@Value("${...}")` ì‚¬ìš© ê°€ëŠ¥.

---

### ğŸ” `createApplicationContext()`

```java
private ConfigurableApplicationContext createApplicationContext() {
    Class<?> contextClass = this.applicationContextClass;

    if (contextClass == null) {
        switch (this.webApplicationType) {
            case SERVLET:
                contextClass = AnnotationConfigServletWebServerApplicationContext.class;
                break;
            case REACTIVE:
                contextClass = AnnotationConfigReactiveWebServerApplicationContext.class;
                break;
            default:
                contextClass = AnnotationConfigApplicationContext.class;
        }
    }
    return (ConfigurableApplicationContext) BeanUtils.instantiateClass(contextClass);
}
```

> ì„œë¸”ë¦¿ ê¸°ë°˜ì—ì„œëŠ” ë””í´íŠ¸íŠ¸ë¡œ `AnnotationConfigServletWebServerApplicationContext`ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.

---

### ğŸ” `refreshContext(context)`

```java
context.refresh();
```

> `refresh()`ëŠ” `ApplicationContext`ì˜ í•µì‹¬ ìƒëª…ì£¼ê¸° ë©”ì„œë“œë¡œ, **BeanFactory ì´ˆê¸°í™”**, **ë¹ˆ ë“±ë¡**, **ë¹ˆ ìƒì„±**, **@PostConstruct í˜¸ì¶œ**, **AOP ì ìš©**, **Event ë°œí–‰**, ë“± í•µì‹¬ ì´ˆê¸°í™”ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

---

### ğŸ” `afterRefresh(context, args)`

```java
callRunners(context, applicationArguments);
```

> `CommandLineRunner`, `ApplicationRunner` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì˜ `run()` ë©”ì„œë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```java
@Bean
public CommandLineRunner init() {
    return args -> System.out.println("ì•± ì‹¤í–‰ í›„ ì´ˆê¸° ì‘ì—… ì‹¤í–‰");
}
```

---

## 5ï¸âƒ£ spring.factories ê¸°ë°˜ì˜ í™•ì¥ì„±

Spring BootëŠ” `META-INF/spring.factories` íŒŒì¼ì„ í†µí•´ ë‹¤ìŒê³¼ ê°™ì€ í™•ì¥ì„ ë¡œë”©í•©ë‹ˆë‹¤:

| íƒ€ì…                              | ì˜ˆì‹œ êµ¬í˜„ì²´                                   |
| ------------------------------- | ---------------------------------------- |
| `ApplicationListener`           | `LoggingApplicationListener`             |
| `ApplicationContextInitializer` | `ContextIdApplicationContextInitializer` |
| `EnvironmentPostProcessor`      | `ConfigFileApplicationListener`          |
| `FailureAnalyzer`               | `BeanNotOfRequiredTypeFailureAnalyzer`   |
| `SpringApplicationRunListener`  | `EventPublishingRunListener`             |

ì´ë“¤ì€ ëª¨ë‘ SpringApplicationì˜ **ëŸ°íƒ€ì„ í™•ì¥ ì§€ì **ì…ë‹ˆë‹¤.

---

## ğŸ§© ì „ì²´ ë¶€íŠ¸ìŠ¤íŠ¸ë© êµ¬ì¡° ìš”ì•½ ë‹¤ì´ì–´ê·¸ë¨

```
@SpringBootApplication
        â†“
SpringApplication.run()
        â†“
[SpringApplication ìƒì„±ì]
        â†“
[run() ì‹¤í–‰]
    â†’ í™˜ê²½ êµ¬ì„±
    â†’ ë¦¬ìŠ¤ë„ˆ ì‹¤í–‰
    â†’ ApplicationContext ìƒì„±
    â†’ AutoConfiguration ìˆ˜í–‰
    â†’ ë¹ˆ ë“±ë¡ ë° ì´ˆê¸°í™” (refresh())
    â†’ CommandLineRunner ì‹¤í–‰
```

---

## âœ… ë§ˆë¬´ë¦¬: í•µì‹¬ ìš”ì•½

| í•­ëª©                           | ì„¤ëª…                        |
| ---------------------------- | ------------------------- |
| `@SpringBootApplication`     | ì„¤ì • í´ë˜ìŠ¤, ìë™ êµ¬ì„±, ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”    |
| `SpringApplication.run()`    | SpringContextë¥¼ ë¶€íŠ¸ìŠ¤íŠ¸ë©í•˜ê³  ì‹¤í–‰ |
| `createApplicationContext()` | ì›¹ íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥¸ Context ìƒì„±    |
| `refresh()`                  | ë¹ˆ íŒ©í† ë¦¬ ì´ˆê¸°í™”, AOP, ì´ë²¤íŠ¸ ë°œí–‰ ë“±  |
| `CommandLineRunner`          | ì•± ì‹¤í–‰ í›„ ë¡œì§ ì‚½ì… ì§€ì            |
| `spring.factories`           | Spring Boot í™•ì¥ ì§€ì  ë¡œë”©      |

