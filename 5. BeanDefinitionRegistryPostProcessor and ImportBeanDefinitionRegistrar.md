# ğŸ§  Springì˜ ë©”íƒ€ë°ì´í„° ì¡°ì‘ì: `BeanDefinitionRegistryPostProcessor` vs `ImportBeanDefinitionRegistrar` ì™„ì „ ì •ë³µ

> â€œSpringì€ ê°ì²´ê°€ ì•„ë‹Œ **ì •ì˜ ìì²´(BeanDefinition)** ë¥¼ ë¨¼ì € ë‹¤ë£¬ë‹¤.
> ê·¸ ì •ì˜ë¥¼ ì¡°ì‘í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ ë°”ë¡œ ì—¬ê¸°ì— ìˆë‹¤.â€

---

## âœ… ê°œìš”

Spring ì»¨í…Œì´ë„ˆëŠ” **Bean ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ì „ì—**,
ëª¨ë“  Beanì˜ **ì •ì˜ ì •ë³´(BeanDefinition)** ë¥¼ ë¨¼ì € ë“±ë¡í•©ë‹ˆë‹¤.

```text
@Order
@Bean
@Component
@Configuration
â†’ ëª¨ë‘ ê²°êµ­ BeanDefinition ìœ¼ë¡œ í•´ì„ë¨
```

ì´ BeanDefinitionì„ **ì§ì ‘ ê°€ë¡œì±„ì„œ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •**í•  ìˆ˜ ìˆëŠ” í™•ì¥ í¬ì¸íŠ¸ê°€ ë‹¤ìŒ ë‘ ê°€ì§€ì…ë‹ˆë‹¤:

| í™•ì¥ í¬ì¸íŠ¸                                | ìš©ë„ ìš”ì•½                                           |
| ------------------------------------- | ----------------------------------------------- |
| `BeanDefinitionRegistryPostProcessor` | **BeanDefinition ìì²´ë¥¼ ì§ì ‘ ìˆ˜ì •/ì¶”ê°€**                 |
| `ImportBeanDefinitionRegistrar`       | `@Import`ë¡œ ì£¼ì…ëœ í´ë˜ìŠ¤ë¥¼ í†µí•´ **ì§ì ‘ BeanDefinition ë“±ë¡** |

---

# ğŸ” 1. `BeanDefinitionRegistryPostProcessor`

## ğŸ“Œ ê°œë…

```java
public interface BeanDefinitionRegistryPostProcessor extends BeanFactoryPostProcessor {
    void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) throws BeansException;
}
```

* `BeanFactoryPostProcessor`ì˜ í•˜ìœ„ ì¸í„°í˜ì´ìŠ¤
* **Beanì´ ì¸ìŠ¤í„´ìŠ¤í™” ë˜ê¸° ì „**, `BeanDefinition` ë ˆë²¨ì—ì„œ ì¡°ì‘ ê°€ëŠ¥
* `@Configuration` í´ë˜ìŠ¤ ì²˜ë¦¬ê¸° (`ConfigurationClassPostProcessor`)ë„ ì´ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ì„

---

## âš™ï¸ ë™ì‘ ì‹œì 

`ApplicationContext.refresh()` í˜¸ì¶œ ì‹œ,
`invokeBeanFactoryPostProcessors()` ë‚´ì—ì„œ ë‹¤ìŒ ìˆœì„œë¡œ í˜¸ì¶œë©ë‹ˆë‹¤:

```java
1. BeanDefinitionRegistryPostProcessor.postProcessBeanDefinitionRegistry()
2. BeanDefinitionRegistryPostProcessor.postProcessBeanFactory()
3. BeanFactoryPostProcessor.postProcessBeanFactory()
```

> ì¦‰, Bean ìƒì„± ì „ ê°€ì¥ ë¨¼ì € ê°œì…í•  ìˆ˜ ìˆëŠ” ì‹œì ì…ë‹ˆë‹¤.

---

## ğŸ› ï¸ ì˜ˆì œ

```java
@Component
public class CustomRegistryPostProcessor implements BeanDefinitionRegistryPostProcessor {
    @Override
    public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) {
        GenericBeanDefinition def = new GenericBeanDefinition();
        def.setBeanClass(MyService.class);
        def.setScope("singleton");
        registry.registerBeanDefinition("myService", def);
    }

    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory factory) {
        // í•„ìš” ì‹œ í›„ì²˜ë¦¬ ê°€ëŠ¥
    }
}
```

âœ… `MyService`ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ì½”ë“œë¡œ ì •ì˜ ì—†ì´ Beanìœ¼ë¡œ ë“±ë¡í•©ë‹ˆë‹¤.

---

## âœ… ì‚¬ìš© ì˜ˆì‹œ

* AOP ì„¤ì • í´ë˜ìŠ¤ ìˆ˜ë™ ë“±ë¡
* Custom Scannerë¡œ íŠ¹ì • íŒ¨í‚¤ì§€ì˜ í´ë˜ìŠ¤ë¥¼ Beanìœ¼ë¡œ ë“±ë¡
* YAML, DB, XML ë“± ì™¸ë¶€ ë©”íƒ€ë°ì´í„°ë¡œ Bean ì •ì˜

---

# ğŸ” 2. `ImportBeanDefinitionRegistrar`

## ğŸ“Œ ê°œë…

```java
public interface ImportBeanDefinitionRegistrar {
    void registerBeanDefinitions(
        AnnotationMetadata importingClassMetadata, 
        BeanDefinitionRegistry registry
    );
}
```

* `@Import`ë¡œ ì£¼ì…ëœ í´ë˜ìŠ¤ì—ì„œ ì‹¤í–‰
* **AnnotationMetadata ë¶„ì„** + BeanDefinition ì§ì ‘ ë“±ë¡
* ì£¼ë¡œ `@EnableXxx` ê³„ì—´ í™•ì¥ì—ì„œ í™œìš©

---

## âš™ï¸ ë™ì‘ íë¦„

```java
@Configuration
@Import(MyRegistrar.class)
public class AppConfig {}

public class MyRegistrar implements ImportBeanDefinitionRegistrar {
    public void registerBeanDefinitions(...) {
        // registryì— ì§ì ‘ ë“±ë¡
    }
}
```

ğŸ“Œ ì°¨ì´ì :

* `BeanDefinitionRegistryPostProcessor`ëŠ” ìë™ ê°ì§€(@Component ë“±)
* `ImportBeanDefinitionRegistrar`ëŠ” ë°˜ë“œì‹œ `@Import`ë¡œ ì£¼ì…í•´ì•¼ ì‹¤í–‰

---

## ğŸ› ï¸ ì˜ˆì œ

```java
public class MyRegistrar implements ImportBeanDefinitionRegistrar {
    @Override
    public void registerBeanDefinitions(AnnotationMetadata metadata, BeanDefinitionRegistry registry) {
        BeanDefinitionBuilder builder = BeanDefinitionBuilder.genericBeanDefinition(MyRepository.class);
        registry.registerBeanDefinition("myRepo", builder.getBeanDefinition());
    }
}
```

ğŸ“Œ í™œìš©:

* `@EnableJpaRepositories`, `@MapperScan`, `@EnableWebSecurity` ë“± ìŠ¤í”„ë§ ìƒíƒœê³„ ê³³ê³³ì— ì¡´ì¬

---

## âœ… ë¹„êµ ìš”ì•½

| í•­ëª©     | BeanDefinitionRegistryPostProcessor | ImportBeanDefinitionRegistrar |
| ------ | ----------------------------------- | ----------------------------- |
| ì‹¤í–‰ ë°©ì‹  | ìë™ ê°ì§€(Component, XML ë“±)             | ë°˜ë“œì‹œ `@Import`ë¡œ ëª…ì‹œì  ì„ ì–¸ í•„ìš”      |
| ë™ì‘ ì‹œì   | ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™” ì´ˆê¸°ì— ì‹¤í–‰                     | `@Configuration` í´ë˜ìŠ¤ ì²˜ë¦¬ ì¤‘ ì‹¤í–‰  |
| í™œìš© ëª©ì   | Bean ì •ì˜ ì „ë°˜ì˜ í›„í‚¹ ë° ë“±ë¡                 | `@EnableXxx` ê³„ì—´ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì— ìµœì í™”   |
| ì‚¬ìš© ë‚œì´ë„ | ì¤‘ê°„                                  | ë‹¤ì†Œ ê³ ê¸‰                         |

---

## ğŸ” ë‘˜ì˜ í˜‘ë ¥ ì˜ˆì‹œ

### ì˜ˆ: `@EnableMyFeature` ì§ì ‘ êµ¬í˜„

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Import(MyRegistrar.class)
public @interface EnableMyFeature {
    String value() default "myFeature";
}
```

```java
public class MyRegistrar implements ImportBeanDefinitionRegistrar {
    public void registerBeanDefinitions(AnnotationMetadata meta, BeanDefinitionRegistry registry) {
        Map<String, Object> attrs = meta.getAnnotationAttributes("com.example.EnableMyFeature");
        String beanName = (String) attrs.get("value");

        GenericBeanDefinition def = new GenericBeanDefinition();
        def.setBeanClass(MyFeatureBean.class);
        registry.registerBeanDefinition(beanName, def);
    }
}
```

âœ… ê²°ê³¼: `@EnableMyFeature("cool")` ì„ ì–¸ë§Œìœ¼ë¡œ `cool`ì´ë¼ëŠ” ì´ë¦„ì˜ Beanì´ ìë™ ë“±ë¡ë¨

---

## ğŸ§  ê²°ë¡ 

| ì§ˆë¬¸                                  | ë‹µë³€ ìš”ì•½                                                    |
| ----------------------------------- | -------------------------------------------------------- |
| Springì´ ì–¸ì œ BeanDefinitionì„ ìˆ˜ì •í•˜ë‚˜?    | `BeanDefinitionRegistryPostProcessor`ë¡œ ì´ˆê¸° ì»¨í…Œì´ë„ˆ êµ¬ì„± ì‹œ ê°€ëŠ¥   |
| ë‚´ê°€ ì›í•˜ëŠ” Beanì„ ì½”ë“œë¡œ ë“±ë¡í•  ìˆ˜ ìˆë‚˜?          | `GenericBeanDefinition`ì„ ìƒì„±í•˜ì—¬ ë“±ë¡ ê°€ëŠ¥                      |
| íŠ¹ì • ì• ë„ˆí…Œì´ì…˜ ê¸°ë°˜ìœ¼ë¡œ Beanì„ ë“±ë¡í•˜ê³  ì‹¶ì€ë°?       | `ImportBeanDefinitionRegistrar`ë¥¼ ì‚¬ìš©í•˜ì—¬ `@Import` ê¸°ë°˜ ë“±ë¡ ê°€ëŠ¥ |
| ìŠ¤í”„ë§ ë‚´ë¶€ëŠ” ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ `@EnableXxx`ë¥¼ ì²˜ë¦¬í•˜ë‚˜? | ëŒ€ë¶€ë¶„ `@Import` + `Registrar` íŒ¨í„´ì„ ì‚¬ìš©í•¨                      |

