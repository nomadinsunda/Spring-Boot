# ğŸ” `@ComponentScan` ì™„ì „ ì •ë³µ â€” ë‚´ë¶€ ì²˜ë¦¬ íë¦„ê³¼ ìŠ¤ìº” ëŒ€ìƒ ê²°ì • ë©”ì»¤ë‹ˆì¦˜

> â€œSpringì´ ì–´ë–»ê²Œ @Component í´ë˜ìŠ¤ë“¤ì„ ìë™ìœ¼ë¡œ ì°¾ëŠ”ì§€,
> ê·¸ ì „ì²´ ë¡œì§ì„ íŒŒí—¤ì³ ë³´ì.â€

---

## âœ… ê°œìš”: `@ComponentScan`ì´ë€?

`@ComponentScan`ì€ Springì´ í´ë˜ìŠ¤íŒ¨ìŠ¤(Classpath)ì—ì„œ
`@Component`, `@Service`, `@Repository`, `@Controller` ê°™ì€
ì• ë…¸í…Œì´ì…˜ì´ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ **ìë™ìœ¼ë¡œ íƒìƒ‰í•˜ê³  Beanìœ¼ë¡œ ë“±ë¡**í•˜ëŠ” í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.

```java
@Configuration
@ComponentScan(basePackages = "com.example")
public class AppConfig {
}
```

ì´ ì„¤ì •ë§Œìœ¼ë¡œ ì§€ì •ëœ íŒ¨í‚¤ì§€ ì´í•˜ì˜ ì»´í¬ë„ŒíŠ¸ê°€ ìë™ìœ¼ë¡œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡ë©ë‹ˆë‹¤.

---

## ğŸ“Œ ê´€ë ¨ ì• ë„ˆí…Œì´ì…˜ ìš”ì•½

| ì• ë„ˆí…Œì´ì…˜            | ì—­í•                 |
| ---------------- | ----------------- |
| `@ComponentScan` | ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ì„¤ì •        |
| `@Component`     | ìŠ¤ìº” ëŒ€ìƒì´ ë˜ëŠ” í´ë˜ìŠ¤     |
| `@Service`       | `@Component`ì˜ íŠ¹ìˆ˜í™” |
| `@Repository`    | `@Component`ì˜ íŠ¹ìˆ˜í™” |
| `@Controller`    | `@Component`ì˜ íŠ¹ìˆ˜í™” |

---

## âœ… 1. ë™ì‘ íë¦„ ê°œìš”

```
@Configuration
@ComponentScan("com.example")
â†“
ConfigurationClassParser
â†“
ComponentScanAnnotationParser
â†“
ClassPathBeanDefinitionScanner
â†“
Candidate ì»´í¬ë„ŒíŠ¸ íƒìƒ‰
â†“
BeanDefinitionRegistry ì— BeanDefinition ë“±ë¡
```

---

## âœ… 2. ë‚´ë¶€ ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### ğŸ“ `ConfigurationClassParser`

* `@ComponentScan`ì´ ë¶™ì€ ì„¤ì • í´ë˜ìŠ¤ë¥¼ ë¶„ì„
* ë‚´ë¶€ì ìœ¼ë¡œ `ComponentScanAnnotationParser`ë¥¼ í˜¸ì¶œ

### ğŸ“ `ComponentScanAnnotationParser`

* `@ComponentScan`ì˜ ì†ì„±ë“¤ì„ í•´ì„
* basePackages, includeFilters, excludeFilters ë“± íŒŒì‹±
* `ClassPathBeanDefinitionScanner`ë¥¼ ìƒì„±í•˜ì—¬ ìŠ¤ìº”ì„ ìœ„ì„

### ğŸ“ `ClassPathBeanDefinitionScanner`

* ì‹¤ì§ˆì ìœ¼ë¡œ í´ë˜ìŠ¤íŒ¨ìŠ¤ë¥¼ íƒìƒ‰
* `.class` íŒŒì¼ì„ ë¡œë”©í•˜ì—¬ ë©”íƒ€ë°ì´í„° ë¶„ì„
* ì¡°ê±´ì— ë§ëŠ” í´ë˜ìŠ¤ë“¤ì„ **BeanDefinition** ìœ¼ë¡œ ë³€í™˜

---

## âœ… 3. ClassPathBeanDefinitionScanner ë™ì‘ ë°©ì‹

```java
ClassPathBeanDefinitionScanner scanner = new ClassPathBeanDefinitionScanner(registry, useDefaultFilters);
scanner.setIncludeAnnotationConfig(true);
scanner.scan(basePackages);
```

### ë‚´ë¶€ í•µì‹¬ ë©”ì„œë“œ: `doScan(String...)`

```java
protected Set<BeanDefinitionHolder> doScan(String... basePackages) {
    for (String basePackage : basePackages) {
        Set<BeanDefinition> candidates = findCandidateComponents(basePackage);
        for (BeanDefinition candidate : candidates) {
            registry.registerBeanDefinition(beanName, candidate);
        }
    }
}
```

---

## âœ… 4. ìŠ¤ìº” ëŒ€ìƒ ê²°ì • ë¡œì§: `findCandidateComponents`

### ë‚´ë¶€ íë¦„

```java
public Set<BeanDefinition> findCandidateComponents(String basePackage) {
    // 1. íŒ¨í‚¤ì§€ ë‚´ ëª¨ë“  í´ë˜ìŠ¤ ë¦¬ì†ŒìŠ¤ ë¡œë”©
    Resource[] resources = resourcePatternResolver.getResources(packageSearchPath);

    for (Resource resource : resources) {
        // 2. ë©”íƒ€ë°ì´í„° ì½ê¸°
        MetadataReader metadataReader = metadataReaderFactory.getMetadataReader(resource);

        // 3. í•„í„° í†µê³¼ ì—¬ë¶€ íŒë‹¨
        if (isCandidateComponent(metadataReader)) {
            // 4. ScannedGenericBeanDefinition ìƒì„±
        }
    }
}
```

### í•µì‹¬ íŒë‹¨ ê¸°ì¤€

* í´ë˜ìŠ¤ê°€ `@Component` í˜¹ì€ ê·¸ í•˜ìœ„ ì• ë„ˆí…Œì´ì…˜ì„ ê°€ì¡ŒëŠ”ê°€?
* í´ë˜ìŠ¤ê°€ ì¸í„°í˜ì´ìŠ¤ê°€ ì•„ë‹Œê°€?
* í´ë˜ìŠ¤ê°€ abstractê°€ ì•„ë‹Œê°€?
* `@Conditional`ì´ ë¶™ì—ˆë‹¤ë©´ ì¡°ê±´ì´ ë§Œì¡±ë˜ëŠ”ê°€?

```java
public boolean isCandidateComponent(MetadataReader metadataReader) {
    return metadataReader.getAnnotationMetadata().isAnnotated("org.springframework.stereotype.Component");
}
```

---

## âœ… 5. í•„í„° ì ìš© ë°©ì‹

### ê¸°ë³¸ í•„í„°

| í•„í„° ì¢…ë¥˜   | ì„¤ëª…                             |
| ------- | ------------------------------ |
| include | `@Component` í•˜ìœ„ ì• ë…¸í…Œì´ì…˜ í¬í•¨       |
| exclude | `@Configuration`, í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ ë“± í•„í„° |

```java
@ComponentScan(
  basePackages = "com.example",
  excludeFilters = @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = Configuration.class)
)
```

### ì»¤ìŠ¤í…€ í•„í„°

```java
@ComponentScan(
  includeFilters = @ComponentScan.Filter(type = FilterType.CUSTOM, classes = MyCustomFilter.class)
)
```

---

## âœ… 6. BeanDefinition ë“±ë¡

ìµœì¢…ì ìœ¼ë¡œ íƒìƒ‰ëœ í´ë˜ìŠ¤ëŠ” `ScannedGenericBeanDefinition`ìœ¼ë¡œ ê°ì‹¸ì ¸
`BeanDefinitionRegistry`ì— ë“±ë¡ë©ë‹ˆë‹¤.

```java
registry.registerBeanDefinition("myService", beanDefinition);
```

ì´í›„ `ApplicationContext.refresh()` ì‹œì ì— ì´ ì •ì˜ë“¤ì´ ì¸ìŠ¤í„´ìŠ¤ë¡œ ìƒì„±ë©ë‹ˆë‹¤.

---

## âœ… 7. ë™ì‘ ìš”ì•½ ë‹¤ì´ì–´ê·¸ë¨

```text
@ComponentScan(basePackages="com.example")
    â†“
ConfigurationClassParser
    â†“
ComponentScanAnnotationParser
    â†“
ClassPathBeanDefinitionScanner
    â†“
findCandidateComponents()
    â†“
MetadataReader ë¡œ í´ë˜ìŠ¤ ë¶„ì„
    â†“
ì¡°ê±´ì— ë§ëŠ” í´ë˜ìŠ¤ë“¤ì„ BeanDefinition ìœ¼ë¡œ ìƒì„±
    â†“
BeanDefinitionRegistry ì— ë“±ë¡
```

---

## âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| í•­ëª©          | ì„¤ëª…                                              |
| ----------- | ----------------------------------------------- |
| ì‚¬ìš© ëª©ì        | íŠ¹ì • íŒ¨í‚¤ì§€ ì´í•˜ì˜ ì»´í¬ë„ŒíŠ¸ ìë™ ë“±ë¡                           |
| ê¸°ë³¸ í•„í„°       | `@Component`, `@Service`, `@Repository` ë“±       |
| ìŠ¤ìº” ëŒ€ìƒ íŒë‹¨ ê¸°ì¤€ | ì• ë…¸í…Œì´ì…˜ ì—¬ë¶€, ì¶”ìƒ í´ë˜ìŠ¤ ì—¬ë¶€ ë“±                           |
| í´ë˜ìŠ¤ ë¡œë”© ë°©ì‹   | `MetadataReader`ë¡œ `.class` ì§ì ‘ ë¶„ì„ (ì„±ëŠ¥ ìµœì í™”)       |
| ìµœì¢… ë“±ë¡       | `ScannedGenericBeanDefinition` ìƒì„± í›„ registry ë“±ë¡ |

