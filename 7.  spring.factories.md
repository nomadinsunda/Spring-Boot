# ğŸ§© `spring.factories` ì™„ì „ ë¶„ì„ â€” Spring Boot í™•ì¥ì˜ ìˆ¨ê²¨ì§„ ì„¤ê³„ í•µì‹¬

> â€œSpring BootëŠ” ì½”ë“œê°€ ì•„ë‹Œ, ë©”íƒ€ë°ì´í„°ë¡œ ë™ì‘ì„ ê²°ì •í•œë‹¤.
> ê·¸ ì¤‘ì‹¬ì— `spring.factories`ê°€ ìˆë‹¤.â€

---

## âœ… ë“¤ì–´ê°€ë©°

Spring BootëŠ” **ìë™ êµ¬ì„±(AutoConfiguration)**, **ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡**, **í™˜ê²½ í›„ì²˜ë¦¬(EnvironmentPostProcessor)** ë“±
ë§¤ìš° ìœ ì—°í•˜ë©´ì„œë„ í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

ì´ ëª¨ë“  í™•ì¥ ì§€ì ì€ **í”„ë¡œê·¸ë˜ë¨¸ê°€ ì§ì ‘ ëª…ì‹œì ìœ¼ë¡œ ë“±ë¡í•˜ì§€ ì•Šì•„ë„**, Spring Bootê°€ ìë™ìœ¼ë¡œ ì¸ì‹í•˜ê³  ì ìš©í•©ë‹ˆë‹¤.

ê·¸ í•µì‹¬ ë™ì‘ì˜ ê¸°ë°˜ì´ ë˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ ë°”ë¡œ `META-INF/spring.factories` íŒŒì¼ì…ë‹ˆë‹¤.

---

## 1ï¸âƒ£ `spring.factories`ë€?

### ğŸ“Œ ì •ì˜

* í´ë˜ìŠ¤íŒ¨ìŠ¤(`classpath`)ì— ìœ„ì¹˜í•œ ë¦¬ì†ŒìŠ¤ íŒŒì¼
* ê²½ë¡œ: `META-INF/spring.factories`
* **Key: Interface ë˜ëŠ” Abstract class (SPI)**
* **Value: êµ¬í˜„ í´ë˜ìŠ¤ì˜ FQCN ëª©ë¡**

### ğŸ“„ ì˜ˆì‹œ êµ¬ì¡°

```properties
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.example.MyAutoConfiguration,\
org.example.OtherAutoConfiguration

org.springframework.context.ApplicationListener=\
org.example.MyAppListener
```

> í•˜ë‚˜ì˜ keyì— ì—¬ëŸ¬ valueë“¤ì„ ì‰¼í‘œë¡œ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 2ï¸âƒ£ ì—­í•  ë° ì ìš© ëŒ€ìƒ

### ëŒ€í‘œì ì¸ í™•ì¥ í¬ì¸íŠ¸

| Key ì¸í„°í˜ì´ìŠ¤/í´ë˜ìŠ¤                   | ì„¤ëª…                                        |
| ------------------------------- | ----------------------------------------- |
| `EnableAutoConfiguration`       | ìë™ êµ¬ì„±ìš© ì„¤ì • í´ë˜ìŠ¤ ëª©ë¡ ì§€ì •                       |
| `ApplicationContextInitializer` | ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” ì „ ë‹¨ê³„ í›„í‚¹                          |
| `ApplicationListener`           | ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìë™ ë“±ë¡                      |
| `SpringApplicationRunListener`  | `SpringApplication.run()` ì´ˆê¸° ë‹¨ê³„ ê°ì²­        |
| `EnvironmentPostProcessor`      | `application.properties` ë¡œë”© ì „ í™˜ê²½ ë³€ìˆ˜ ì¡°ì‘ ê°€ëŠ¥ |
| `FailureAnalyzer`               | ì˜ˆì™¸ ë°œìƒ ì‹œ ì‚¬ìš©ì ì¹œí™”ì ì¸ ë©”ì‹œì§€ ì œê³µ                   |

---

## 3ï¸âƒ£ ë‚´ë¶€ ë™ì‘ êµ¬ì¡°

### ğŸ“ ë¡œë”© ì½”ë“œ: `SpringFactoriesLoader`

Spring BootëŠ” `spring.factories`ë¥¼ ë‹¤ìŒì²˜ëŸ¼ ì½ì–´ë“¤ì…ë‹ˆë‹¤:

```java
List<String> factoryClassNames =
    SpringFactoriesLoader.loadFactoryNames(MyInterface.class, classLoader);
```

```java
public static List<String> loadFactoryNames(Class<?> factoryType, ClassLoader classLoader) {
    String factoryTypeName = factoryType.getName();
    Enumeration<URL> urls = classLoader.getResources(FACTORIES_RESOURCE_LOCATION);

    for (URL url : urls) {
        Properties properties = PropertiesLoaderUtils.loadProperties(url);
        ...
        result.addAll(Arrays.asList(properties.getProperty(factoryTypeName).split(",")));
    }
}
```

> ì¦‰, ëª¨ë“  `META-INF/spring.factories` íŒŒì¼ë“¤ì„ **ë³‘í•©í•˜ì—¬ ì „ì²´ value ëª©ë¡ì„ ì¶”ì¶œ**í•©ë‹ˆë‹¤.

---

## 4ï¸âƒ£ ì£¼ìš” ì˜ˆì‹œ

### ğŸ”§ ìë™ êµ¬ì„±: `EnableAutoConfiguration`

```properties
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\
org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration
```

â¡ `@EnableAutoConfiguration`ì€ ë‚´ë¶€ì ìœ¼ë¡œ `AutoConfigurationImportSelector`ë¥¼ í†µí•´ ì´ í•­ëª©ì„ ë¡œë”©í•©ë‹ˆë‹¤.

---

### ğŸ”§ í™˜ê²½ í›„ì²˜ë¦¬ê¸°: `EnvironmentPostProcessor`

```properties
org.springframework.boot.env.EnvironmentPostProcessor=\
com.example.MyYamlProcessor
```

â¡ `application.properties`, `application.yml`ì´ ë¡œë”©ë˜ê¸° ì „,
ì¶”ê°€ ì„¤ì • íŒŒì¼ì„ ì½ê±°ë‚˜ ë™ì ìœ¼ë¡œ í”„ë¡œíŒŒì¼ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### ğŸ”§ ApplicationListener

```properties
org.springframework.context.ApplicationListener=\
com.example.MyStartupLogger
```

â¡ `ApplicationReadyEvent` ë“± ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ìë™ ê°ì²­í•˜ì—¬ ì²˜ë¦¬ ê°€ëŠ¥

---

## 5ï¸âƒ£ ì»¤ìŠ¤í…€ í™•ì¥ ë§Œë“¤ê¸°

### ğŸ“ ë””ë ‰í„°ë¦¬ êµ¬ì¡°

```
src/main/resources/
â””â”€â”€ META-INF/
    â””â”€â”€ spring.factories
```

### ğŸ“„ spring.factories ì˜ˆì‹œ

```properties
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.example.autoconfig.MyAutoConfiguration
```

### â˜• êµ¬ì„± í´ë˜ìŠ¤

```java
@Configuration
public class MyAutoConfiguration {
    @Bean
    public MyBean myBean() {
        return new MyBean();
    }
}
```

â¡ í•´ë‹¹ JARì„ classpathì— ë„£ê¸°ë§Œ í•˜ë©´ Spring Bootê°€ ìë™ ì¸ì‹í•˜ì—¬ Beanì„ ë“±ë¡í•©ë‹ˆë‹¤.

---

## âœ… spring.factories vs SPI (ServiceLoader)

| í•­ëª©           | `spring.factories`           | JDK SPI (`META-INF/services/`) |
| ------------ | ---------------------------- | ------------------------------ |
| ê¸°ë³¸ ëª©ì         | Spring Bootìš© í™•ì¥ ì„¤ì •           | JDK/Java ê¸°ë°˜ì˜ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ ë¡œë”©      |
| í‚¤/ê°’ êµ¬ì¡°       | `interface FQCN` = êµ¬í˜„ í´ë˜ìŠ¤ ëª©ë¡ | íŒŒì¼ëª…: interface, ë‚´ìš©: êµ¬í˜„ í´ë˜ìŠ¤ ëª©ë¡  |
| ë‹¤ì¤‘ ëª¨ë“ˆ ë³‘í•©     | ì§€ì›ë¨ (`List<URL>` ìˆ˜ì§‘)         | ë³‘í•©ë˜ì§€ ì•ŠìŒ, ì˜¤ë²„ë¼ì´ë”© ë°œìƒ              |
| ë™ê¸°í™”/ì‹¤í–‰ ì‹œì  ì œì–´ | Spring ì»¨í…ìŠ¤íŠ¸ íë¦„ ë‚´ì—ì„œ ì œì–´ ê°€ëŠ¥     | ë‹¨ìˆœ ë¡œë”©                          |

---

## ğŸ“¦ Spring Boot 3 ì´í›„ ë³€í™”?

Spring Boot 3.xë¶€í„°ëŠ” ì ì°¨ì ìœ¼ë¡œ `spring.factories` ëŒ€ì‹ 
**`META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports`**
í˜•íƒœì˜ ìƒˆë¡œìš´ ë©”íƒ€íŒŒì¼ ê¸°ë°˜ êµ¬ì„±ë„ ë„ì…ë˜ê³  ìˆìŠµë‹ˆë‹¤. (â†’ AOT ìµœì í™” ëª©ì )

í•˜ì§€ë§Œ ì—¬ì „íˆ `spring.factories`ëŠ” í•µì‹¬ í™•ì¥ í¬ì¸íŠ¸ë¡œ **ê´‘ë²”ìœ„í•˜ê²Œ ì‚¬ìš©**ë©ë‹ˆë‹¤.

---

## ğŸ§  ë§ˆë¬´ë¦¬ ìš”ì•½

| ì§ˆë¬¸                               | ìš”ì•½ ë‹µë³€                                               |
| -------------------------------- | --------------------------------------------------- |
| Spring BootëŠ” ì–´ë–»ê²Œ ìë™ ì„¤ì • í´ë˜ìŠ¤ë¥¼ ì°¾ì„ê¹Œ? | `EnableAutoConfiguration` â†’ `spring.factories`ì—ì„œ ë¡œë”© |
| ë³„ë„ ì„¤ì • ì—†ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¦¬ìŠ¤ë„ˆê°€ ë“±ë¡ë˜ëŠ” ì´ìœ ëŠ”?   | `ApplicationListener` í‚¤ë¥¼ í†µí•´ ìë™ ì£¼ì…ë¨                  |
| ë‚´ê°€ ë§Œë“  ìë™ ì„¤ì •ì„ ì ìš©í•˜ë ¤ë©´?              | ë‚´ JARì— `spring.factories` íŒŒì¼ì„ ì¶”ê°€í•˜ë©´ ë¨                |

