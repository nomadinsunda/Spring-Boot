# ğŸ§¬ `BeanDefinition` ì™„ì „ ë¶„ì„ â€” Spring ì»¨í…Œì´ë„ˆì˜ ì§„ì§œ í•µì‹¬ì€ ê°ì²´ê°€ ì•„ë‹ˆë¼ ì •ì˜ë‹¤

> "Springì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤.
> ê·¸ ì „ì— ë¨¼ì € **Beanì˜ ì •ì˜(Definition)** ë¥¼ ë“±ë¡í•˜ê³  ê´€ë¦¬í•œë‹¤."

---

## âœ… 1. BeanDefinitionì´ë€?

### ğŸ“Œ ê°œë…

`BeanDefinition`ì€ Spring Containerê°€ ê´€ë¦¬í•˜ëŠ” ëª¨ë“  ê°ì²´(Bean)ì— ëŒ€í•œ **ë©”íƒ€ì •ë³´(Metadata)** ë¥¼ ë‹´ëŠ” ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.

> ì¦‰, **Beanì˜ ì¸ìŠ¤í„´ìŠ¤ ìì²´ê°€ ì•„ë‹ˆë¼, í•´ë‹¹ ê°ì²´ë¥¼ ì–´ë–»ê²Œ ë§Œë“¤ì§€ë¥¼ ì„¤ëª…í•˜ëŠ” ì„¤ê³„ë„**ì…ë‹ˆë‹¤.

---

## âœ… 2. í•µì‹¬ ì†ì„±ë“¤

```java
public interface BeanDefinition extends AttributeAccessor, BeanMetadataElement {
    String SCOPE_SINGLETON = ConfigurableBeanFactory.SCOPE_SINGLETON;
    String SCOPE_PROTOTYPE = ConfigurableBeanFactory.SCOPE_PROTOTYPE;

    String getBeanClassName();
    String getScope();
    boolean isLazyInit();
    String[] getDependsOn();
    boolean isAutowireCandidate();
    ConstructorArgumentValues getConstructorArgumentValues();
    MutablePropertyValues getPropertyValues();
    ...
}
```

### ì£¼ìš” í•„ë“œ ì„¤ëª…

| í•„ë“œ                          | ì„¤ëª…                                    |
| --------------------------- | ------------------------------------- |
| `beanClassName`             | ì‹¤ì œ Beanì´ ìƒì„±ë  í´ë˜ìŠ¤ ì´ë¦„ (FQCN)            |
| `scope`                     | singleton, prototype ë“±                |
| `lazyInit`                  | ì§€ì—° ì´ˆê¸°í™” ì—¬ë¶€                             |
| `dependsOn`                 | ë‹¤ë¥¸ Beanì— ëŒ€í•œ ì˜ì¡´ì„± ëª…ì‹œ                    |
| `autowireCandidate`         | ìë™ ì£¼ì… ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œì§€ ì—¬ë¶€                 |
| `constructorArgumentValues` | ìƒì„±ì ì•„ê·œë¨¼íŠ¸ ëª©ë¡                           |
| `propertyValues`            | `@Autowired`, XML `<property>` ë“± ì„¤ì • ê°’ |

---

## âœ… 3. êµ¬í˜„ì²´ ì¢…ë¥˜

| êµ¬í˜„ í´ë˜ìŠ¤                           | ìš©ë„                              |
| -------------------------------- | ------------------------------- |
| `RootBeanDefinition`             | ëŒ€ë¶€ë¶„ì˜ ì¼ë°˜ Beanì— ì‚¬ìš©                |
| `GenericBeanDefinition`          | ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œìê°€ ë“±ë¡í•˜ëŠ” ì¼ë°˜ ì •ì˜          |
| `ScannedGenericBeanDefinition`   | `@ComponentScan`ì— ì˜í•´ íƒì§€ëœ í´ë˜ìŠ¤ìš©   |
| `AnnotatedGenericBeanDefinition` | `@Configuration` ë“± ì• ë„ˆí…Œì´ì…˜ ê¸°ë°˜ ë“±ë¡ìš© |
| `ChildBeanDefinition`            | ìƒì†ëœ Bean ì •ì˜ (ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ)         |

---

## âœ… 4. BeanDefinitionì˜ ë“±ë¡ ê³¼ì •

### ğŸ“Œ ë™ì‘ ì‹œì 

Springì˜ `ApplicationContext`ê°€ ì´ˆê¸°í™”ë˜ëŠ” ê³¼ì •ì—ì„œ
ëª¨ë“  `@Component`, `@Configuration`, `@Bean`, XML, íŒ©í† ë¦¬ ë“±ì„
**BeanDefinitionìœ¼ë¡œ ë¨¼ì € ë“±ë¡**í•©ë‹ˆë‹¤.

---

### ğŸ” ì „ì²´ íë¦„ ìš”ì•½

```text
1. ConfigurationClassPostProcessor
    â†’ @Configuration í´ë˜ìŠ¤ íŒŒì‹±
    â†’ @Bean ë©”ì„œë“œ ë“± ë¶„ì„
    â†’ BeanDefinition ìƒì„±
2. ComponentScan
    â†’ @Component í´ë˜ìŠ¤ íƒì§€
    â†’ ScannedGenericBeanDefinition ìƒì„±
3. @Import / Registrar
    â†’ ì§ì ‘ BeanDefinitionRegistryì— ë“±ë¡
4. XmlBeanDefinitionReader
    â†’ XML <bean> â†’ GenericBeanDefinition ìƒì„±
```

---

### ğŸ“˜ ì˜ˆ: Annotation ê¸°ë°˜ ë“±ë¡

```java
@Configuration
public class AppConfig {
    @Bean
    public UserService userService() {
        return new UserServiceImpl();
    }
}
```

â¡ `ConfigurationClassPostProcessor`ê°€ ì´ ë©”ì„œë“œë¥¼ `BeanMethod`ë¡œ ë¶„ì„í•˜ê³ 
`BeanDefinitionBuilder`ë¥¼ í†µí•´ ë‹¤ìŒê³¼ ê°™ì€ ì •ì˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:

```text
beanName: "userService"
beanClass: AppConfig$$EnhancerByCGLIB
factoryMethod: userService()
scope: singleton
```

---

### ğŸ“˜ ì˜ˆ: ComponentScan ê¸°ë°˜ ë“±ë¡

```java
@Component
public class OrderService { }
```

â¡ `ClassPathBeanDefinitionScanner`ê°€ íƒìƒ‰ í›„ ìƒì„±:

```text
BeanDefinition: ScannedGenericBeanDefinition
beanClassName: com.example.OrderService
metadata: AnnotationMetadata
scope: singleton
```

---

### ğŸ“˜ ì˜ˆ: XML ê¸°ë°˜ ë“±ë¡

```xml
<bean id="productService" class="com.example.ProductService"/>
```

â¡ `XmlBeanDefinitionReader`ê°€ `GenericBeanDefinition`ìœ¼ë¡œ ë³€í™˜:

```text
beanName: "productService"
beanClass: com.example.ProductService
scope: singleton
```

---

## âœ… 5. ë“±ë¡ ìœ„ì¹˜: BeanDefinitionRegistry

```java
public interface BeanDefinitionRegistry {
    void registerBeanDefinition(String beanName, BeanDefinition beanDefinition);
}
```

ëª¨ë“  `ApplicationContext`ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ `DefaultListableBeanFactory`ë¥¼ í¬í•¨í•˜ë©°
ì´ ê°ì²´ê°€ `BeanDefinitionRegistry` ì—­í• ì„ í•©ë‹ˆë‹¤.

---

## âœ… 6. ë“±ë¡ëœ ì •ì˜ â†’ ì‹¤ì œ Beanìœ¼ë¡œ ë³€í™˜: `refresh()` ì´í›„

```java
AbstractApplicationContext.refresh()
    â†“
invokeBeanFactoryPostProcessors()
    â†“
registerBeanPostProcessors()
    â†“
finishBeanFactoryInitialization()
    â†“
â†’ getBean() í˜¸ì¶œ â†’ createBean() â†’ populate â†’ initialize
```

ì´ ì‹œì ì— `BeanDefinition` â†’ `BeanWrapper` â†’ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.

---

## âœ… 7. êµ¬ì¡° ë‹¤ì´ì–´ê·¸ë¨

```
@Component
     â†“
ClassPathScanner
     â†“
ScannedGenericBeanDefinition
     â†“
BeanDefinitionRegistry.register()
     â†“
ApplicationContext.refresh()
     â†“
DefaultListableBeanFactory.getBean()
     â†“
instantiate + populate + init
```

---

## âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| í•­ëª©                 | ë‚´ìš©                                                                              |
| ------------------ | ------------------------------------------------------------------------------- |
| BeanDefinitionì˜ ì •ì²´ | Beanì„ ë§Œë“¤ê¸° ìœ„í•œ ë©”íƒ€ì •ë³´                                                               |
| ì–´ë””ì— ë“±ë¡ë˜ëŠ”ê°€?         | `BeanDefinitionRegistry` = `DefaultListableBeanFactory`                         |
| ëˆ„ê°€ ë“±ë¡í•˜ëŠ”ê°€?          | `@ComponentScan`, `@Configuration`, `@Import`, XML ë“±                            |
| ì–¸ì œ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë³€í™˜ë˜ëŠ”ê°€?    | `ApplicationContext.refresh()` ì¤‘ `getBean()` ì‹œì                                  |
| ì–´ë–¤ íƒ€ì…ì´ ìˆëŠ”ê°€?        | `RootBeanDefinition`, `GenericBeanDefinition`, `ScannedGenericBeanDefinition` ë“± |

