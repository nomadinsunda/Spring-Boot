# ğŸ§  `@ConditionalOnClass` vs `@ConditionalOnBean` â€” ì¡°ê±´ ê¸°ë°˜ ìë™ êµ¬ì„±ì˜ í•µì‹¬ ì›ë¦¬

> â€œSpring Bootì˜ ìë™ êµ¬ì„±ì€ ë‹¨ìˆœí•œ if ë¬¸ì´ ì•„ë‹ˆë‹¤.
> ì •êµí•œ ì¡°ê±´ ì²´ê³„ì˜ ì¤‘ì‹¬ì—ëŠ” `@Conditional` ê¸°ë°˜ì˜ ì¡°í•©ì´ ìˆë‹¤.â€

---

## âœ… 1. `@Conditional` ë©”íƒ€ ì• ë„ˆí…Œì´ì…˜ ê¸°ë°˜ ì„¤ê³„

Spring Bootì˜ ëª¨ë“  ì¡°ê±´ë¶€ ì• ë„ˆí…Œì´ì…˜(`@ConditionalOnXxx`)ì€
ì‚¬ì‹¤ìƒ ë‚´ë¶€ì ìœ¼ë¡œ **`@Conditional(Condition.class)`** ë©”íƒ€ ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```java
@Target({ElementType.TYPE, ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Conditional(OnClassCondition.class)
public @interface ConditionalOnClass {
    Class<?>[] value() default {};
}
```

---

## âœ… 2. ê³µí†µ ì²˜ë¦¬ íë¦„

### ì¡°ê±´ ì• ë„ˆí…Œì´ì…˜ì˜ ì‹¤í–‰ ì‹œì 

```text
1. AutoConfigurationImportSelector
    â†’ ConfigurationClassParser
        â†’ shouldSkip(AnnotationMetadata metadata)
            â†’ ConditionEvaluator.shouldSkip()
                â†’ matches() == false â†’ êµ¬ì„± í´ë˜ìŠ¤ ì œì™¸
```

ì¦‰, `@ConditionalOnXxx` ê³„ì—´ ì• ë„ˆí…Œì´ì…˜ì€
**ìë™ ì„¤ì • í´ë˜ìŠ¤ê°€ ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡ë˜ê¸° ì „**ì— í•„í„°ë§ ë©ë‹ˆë‹¤.

---

## âœ… 3. `@ConditionalOnClass` ë™ì‘ ì›ë¦¬

### ì—­í• 

* í´ë˜ìŠ¤íŒ¨ìŠ¤ì— íŠ¹ì • í´ë˜ìŠ¤ê°€ ì¡´ì¬í•  ê²½ìš°ì—ë§Œ í•´ë‹¹ êµ¬ì„± í´ë˜ìŠ¤ ë˜ëŠ” Beanì„ ë“±ë¡

### ì‚¬ìš© ì˜ˆì‹œ

```java
@ConditionalOnClass(name = "com.zaxxer.hikari.HikariDataSource")
@Configuration
public class HikariAutoConfiguration {
    ...
}
```

### ë‚´ë¶€ êµ¬ì¡°

```java
@Target({ElementType.TYPE, ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Conditional(OnClassCondition.class)
public @interface ConditionalOnClass {
    Class<?>[] value() default {};
    String[] name() default {};
}
```

### í•µì‹¬ êµ¬í˜„: `OnClassCondition`

```java
public class OnClassCondition extends SpringBootCondition {
    @Override
    public ConditionOutcome getMatchOutcome(ConditionContext context, AnnotatedTypeMetadata metadata) {
        List<String> classNames = getClassNames(metadata);
        ConditionMessage.Builder message = ConditionMessage.forCondition(ConditionalOnClass.class);

        for (String className : classNames) {
            if (!ClassUtils.isPresent(className, context.getClassLoader())) {
                return ConditionOutcome.noMatch(message.didNotFind("class", "classes").items(className));
            }
        }
        return ConditionOutcome.match(message.found("class", "classes").items(classNames));
    }
}
```

### ë™ì‘ ìš”ì•½

| ë‹¨ê³„ | ì„¤ëª…                                     |
| -- | -------------------------------------- |
| 1  | `@ConditionalOnClass` ê°’ì—ì„œ í´ë˜ìŠ¤ ì´ë¦„ ëª©ë¡ ì¶”ì¶œ |
| 2  | `ClassUtils.isPresent(...)`ë¡œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸  |
| 3  | í•˜ë‚˜ë¼ë„ ì—†ìœ¼ë©´ noMatch â†’ êµ¬ì„± í´ë˜ìŠ¤ ë“±ë¡ ì•ˆ ë¨       |

---

## âœ… 4. `@ConditionalOnBean` ë™ì‘ ì›ë¦¬

### ì—­í• 

* íŠ¹ì • íƒ€ì… ë˜ëŠ” ì´ë¦„ì˜ Beanì´ **ì´ë¯¸ ì»¨í…ìŠ¤íŠ¸ì— ì¡´ì¬í•˜ëŠ” ê²½ìš°**ì—ë§Œ Beanì„ ë“±ë¡

### ì˜ˆì‹œ

```java
@ConditionalOnBean(DataSource.class)
@Bean
public JdbcTemplate jdbcTemplate(DataSource dataSource) {
    return new JdbcTemplate(dataSource);
}
```

### ë‚´ë¶€ êµ¬ì¡°

```java
@Target({ElementType.TYPE, ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Conditional(OnBeanCondition.class)
public @interface ConditionalOnBean {
    Class<?>[] value() default {};
    String[] name() default {};
    Class<?>[] type() default {};
}
```

### í•µì‹¬ êµ¬í˜„: `OnBeanCondition`

```java
public class OnBeanCondition extends FilteringSpringBootCondition {
    @Override
    public ConditionOutcome getMatchOutcome(ConditionContext context, AnnotatedTypeMetadata metadata) {
        BeanTypeRegistry registry = BeanTypeRegistry.get(context.getBeanFactory());

        ConditionMessage.Builder message = ConditionMessage.forCondition(ConditionalOnBean.class);
        MatchResult matchResult = getMatchingBeans(context, metadata);

        if (matchResult.isAllMatched()) {
            return ConditionOutcome.match(message.found("bean", "beans").items(matchResult.getNamesOfAllMatches()));
        }

        return ConditionOutcome.noMatch(message.didNotFind("bean", "beans").items(matchResult.getNamesOfAllMatches()));
    }
}
```

### ë™ì‘ ìš”ì•½

| ë‹¨ê³„ | ì„¤ëª…                                              |
| -- | ----------------------------------------------- |
| 1  | ApplicationContext ë‚´ì— ì§€ì •ëœ íƒ€ì…/ì´ë¦„ì˜ Beanì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ |
| 2  | ìˆìœ¼ë©´ match â†’ í•´ë‹¹ êµ¬ì„± ë˜ëŠ” Bean ë“±ë¡                    |
| 3  | ì—†ìœ¼ë©´ noMatch â†’ ì œì™¸ë¨                               |

---

## âœ… 5. `@ConditionalOnMissingBean`ê³¼ì˜ ì°¨ì´

| ì¡°ê±´ ì• ë„ˆí…Œì´ì…˜                    | ì¡°ê±´            |
| --------------------------- | ------------- |
| `@ConditionalOnBean`        | Beanì´ ìˆì–´ì•¼ ë“±ë¡ë¨ |
| `@ConditionalOnMissingBean` | Beanì´ ì—†ì–´ì•¼ ë“±ë¡ë¨ |

ë‘˜ ë‹¤ ë‚´ë¶€ì ìœ¼ë¡œ `OnBeanCondition`ì„ ê³µìœ í•˜ë©°, `SearchStrategy.CURRENT`(ê¸°ë³¸ê°’) ë²”ìœ„ ë‚´ì—ì„œ ê²€ìƒ‰í•©ë‹ˆë‹¤.

---

## âœ… 6. ConditionOutcomeê³¼ ë””ë²„ê¹…

ëª¨ë“  ì¡°ê±´ì˜ í‰ê°€ ê²°ê³¼ëŠ” ë‹¤ìŒì„ í†µí•´ í™•ì¸ ê°€ëŠ¥:

```text
org.springframework.boot.autoconfigure.condition.ConditionEvaluationReport
```

Actuatorë¥¼ í†µí•´ `/actuator/conditions`ë¥¼ í™œì„±í™”í•˜ë©´ ìë™ êµ¬ì„± ì‹¤íŒ¨ ì‚¬ìœ ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## âœ… 7. ë§ˆë¬´ë¦¬ ë¹„êµ ìš”ì•½

| í•­ëª©        | `@ConditionalOnClass`   | `@ConditionalOnBean`    |
| --------- | ----------------------- | ----------------------- |
| ì²´í¬ ëŒ€ìƒ     | í´ë˜ìŠ¤ ì¡´ì¬ ì—¬ë¶€               | Bean ì¡´ì¬ ì—¬ë¶€              |
| íŒë‹¨ ì‹œì      | í´ë˜ìŠ¤ ë¡œë”© ì „ (classpath ê²€ì‚¬) | BeanDefinition ë“±ë¡ ì´í›„    |
| ì ìš© ìœ„ì¹˜     | í´ë˜ìŠ¤ / ë©”ì„œë“œ               | í´ë˜ìŠ¤ / ë©”ì„œë“œ               |
| ëŒ€í‘œ êµ¬í˜„ í´ë˜ìŠ¤ | `OnClassCondition`      | `OnBeanCondition`       |
| ì£¼ìš” ì‚¬ìš© ìš©ë„  | ëª¨ë“ˆì´ í´ë˜ìŠ¤íŒ¨ìŠ¤ì— ìˆì„ ê²½ìš°ë§Œ ìë™ êµ¬ì„± | íŠ¹ì • Beanì´ ì„¤ì •ë˜ì—ˆì„ ë•Œë§Œ êµ¬ì„± ì§„í–‰ |

