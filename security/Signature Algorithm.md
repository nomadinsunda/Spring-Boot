# 🔐 서명 알고리즘(Signature Algorithm)

## 1️⃣ 서명 알고리즘이란?

\*\*서명 알고리즘(Signature Algorithm)\*\*은 디지털 메시지(예: JWT, 전자문서 등)에 **디지털 서명**을 생성하는 데 사용되는 알고리즘입니다.

디지털 서명은 다음과 같은 역할을 합니다:

| 역할       | 설명                                       |
| -------- | ---------------------------------------- |
| ✅ 무결성 보장 | 메시지가 도중에 변조되지 않았는지 검증 가능                 |
| ✅ 송신자 인증 | 서명자가 누구인지 검증 가능 (특히 비대칭키 기반)             |
| ✅ 부인 방지  | 송신자가 보낸 메시지임을 부인할 수 없음 (non-repudiation) |

---

## 2️⃣ 서명 알고리즘의 종류

서명 알고리즘은 크게 **두 가지 방식**으로 나뉩니다:

### 🔹 (1) 대칭 키 방식 — HMAC 기반

| 이름      | 알고리즘           | 특징                |
| ------- | -------------- | ----------------- |
| `HS256` | HMAC + SHA-256 | 빠르고 간단, 대칭 키 필요   |
| `HS384` | HMAC + SHA-384 | 더 긴 해시 출력         |
| `HS512` | HMAC + SHA-512 | 더 강력한 보안성, 긴 키 권장 |

* `HSxxx` 계열은 모두 HMAC(Hash-based Message Authentication Code) 기반
* 서명과 검증에 **동일한 비밀키(secret key)** 사용
* **JWT 기본 예제에서 가장 많이 사용됨**

```plaintext
signature = HMAC(secret_key, header.payload)
```

### 🔹 (2) 비대칭 키 방식 — 공개/개인키 기반

| 이름      | 알고리즘                            | 특징                           |
| ------- | ------------------------------- | ---------------------------- |
| `RS256` | RSA + SHA-256                   | 공개키 기반 서명/검증                 |
| `RS512` | RSA + SHA-512                   | 더 강력한 RSA 서명                 |
| `ES256` | ECDSA + SHA-256                 | 타원곡선 기반, RSA보다 짧은 키로 동일한 보안성 |
| `EdDSA` | Edwards Curve Digital Signature | 최신 기술, 빠르고 안전 (Ed25519 등)    |

* 개인 키로 서명, **공개 키로 검증**
* 공개키를 통해 누구나 서명 검증 가능 → **토큰 발급자를 신뢰할 수 있음**
* OAuth 2.0 / OpenID Connect의 \*\*ID 토큰(JWK 포함)\*\*에서 주로 사용

```plaintext
signature = Sign(private_key, header.payload)
→ 검증: Verify(public_key, header.payload, signature)
```

---

## 3️⃣ 서명 알고리즘 비교

| 항목     | 대칭 방식 (HMAC)     | 비대칭 방식 (RSA, ECDSA 등)     |
| ------ | ---------------- | ------------------------- |
| 키 개수   | 하나 (secret key)  | 두 개 (private/public key)  |
| 속도     | 빠름               | 느림                        |
| 사용 용도  | 단일 서버, 간단한 시스템   | 다중 시스템, 외부 검증 가능해야 함      |
| 보안 강도  | 키 유출 시 위험        | 공개키 유출 무해, 개인키만 보호        |
| 예시     | `HS256`, `HS512` | `RS256`, `ES256`          |
| JWT 사용 | 서버 내 자체 검증       | 인증서 기반 federated auth에 적합 |

---

## 4️⃣ 서명 알고리즘 내부 원리

### 🔸 HMAC-SHA 알고리즘 (예: HS256)

1. 메시지(헤더+페이로드)를 준비
2. 비밀 키와 함께 SHA 해시 수행
3. 결과값을 서명으로 사용

```java
Signature = HMAC-SHA256(secret, header.payload)
```

> `Keys.hmacShaKeyFor(byte[])`는 secret 키의 길이를 기준으로 HMAC에 적합한 Key 객체 생성

---

### 🔸 RSA-SHA 알고리즘 (예: RS256)

1. 개인 키로 `SHA-256(header.payload)`를 해시한 값을 **서명**
2. 공개 키로 서명값과 데이터가 일치하는지 **검증**

---

### 🔸 ECDSA (Elliptic Curve DSA)

* RSA보다 더 짧은 키 길이로 동일한 보안성
* 서버 성능이 중요한 환경에서 선호

---

## 5️⃣ JWT의 alg 필드

JWT Header에 사용되는 서명 알고리즘은 `alg` 필드로 명시됩니다.

```json
{
  "alg": "HS512",
  "typ": "JWT"
}
```

이 필드는 토큰 해석 및 검증 시 반드시 일치해야 합니다.

---

## 6️⃣ 실전에서 어떤 알고리즘을 써야 할까?

| 상황                         | 추천 알고리즘                          |
| -------------------------- | -------------------------------- |
| 단일 서버에서 간단한 인증 처리          | `HS256` 또는 `HS512`               |
| 인증서 기반, 공개키 기반 검증 필요       | `RS256`, `ES256`                 |
| 클라우드 환경에서 빠른 검증 요구         | `EdDSA` (Ed25519)                |
| OpenID Connect / OAuth2 사용 | `RS256`, `ES256` (JWK 기반 공개키 전달) |

---

## 7️⃣ 보안 관련 주의사항

* **HSxxx 사용 시 secret key는 256비트 이상**을 강력히 권장 (최소 32바이트 이상)
* **RSxxx/ESxxx 사용 시 공개키가 외부에 노출되어도 무방하지만, 개인키는 절대 노출 금지**
* `alg: none`은 공격자가 서명을 제거해버릴 수 있으므로 절대 비활성화해야 함

---

## ✅ 요약

| 개념         | 설명                                |
| ---------- | --------------------------------- |
| 서명 알고리즘이란  | 메시지 무결성과 송신자 인증을 위한 디지털 서명 생성 방식  |
| HMAC 계열    | HS256/HS512: 대칭키 기반, 빠름, 서버 내부 사용 |
| RSA/ECDSA  | 비대칭키 기반, 공개 검증 가능, 외부 인증 적합       |
| JWT Header | `alg` 필드로 서명 알고리즘 명시              |
| 선택 기준      | 성능, 보안성, 외부 검증 여부에 따라 선택          |


* `Keys.hmacShaKeyFor()` 내부 동작
* `java.security.Signature` API 기반 서명 생성 예제
* JWT 알고리즘 공격 사례 및 방어 전략 (예: alg none 공격)

필요하신 주제를 말씀해 주세요!
