## ğŸ” BeanDefinitionê³¼ BeanPostProcessorì˜ í˜‘ì—… êµ¬ì¡° ì™„ì „ ë¶„ì„

---

### âœ… 1. BeanDefinitionì´ë€?

```java
public interface BeanDefinition {
    String getBeanClassName();
    String getScope();
    boolean isLazyInit();
    ConstructorArgumentValues getConstructorArgumentValues();
    MutablePropertyValues getPropertyValues();
}
```

* Bean ìƒì„± ì „ì— ë“±ë¡ë˜ëŠ” **ì •ì  ë©”íƒ€ ì •ë³´**
* `@Bean`, `@Component`, XML ë“±ì—ì„œ ì •ì˜í•œ ë©”íƒ€ë°ì´í„°ê°€ `BeanDefinition`ìœ¼ë¡œ ë“±ë¡ë¨
* ë‚´ë¶€ì—ëŠ” í´ë˜ìŠ¤ íƒ€ì…, ìƒì„±ì ì¸ì, í”„ë¡œí¼í‹° ì •ë³´, ìŠ¤ì½”í”„ ì •ë³´ ë“±ì„ ë‹´ê³  ìˆìŒ
* ë“±ë¡ ìœ„ì¹˜: `BeanDefinitionRegistry` â†’ `DefaultListableBeanFactory`

---

### âœ… 2. BeanPostProcessorë€?

```java
public interface BeanPostProcessor {
    Object postProcessBeforeInitialization(Object bean, String beanName);
    Object postProcessAfterInitialization(Object bean, String beanName);
}
```

* **Beanì´ ìƒì„±ë˜ê³  ì˜ì¡´ì„± ì£¼ì…ê¹Œì§€ ëë‚œ í›„**, ì´ˆê¸°í™” ì „/í›„ì— í›„ì²˜ë¦¬ë¥¼ ìˆ˜í–‰
* ì£¼ë¡œ í”„ë¡ì‹œ ìƒì„±, DI ì»¤ìŠ¤í„°ë§ˆì´ì§•, AOP ì ìš©, Validation ì²˜ë¦¬ ë“±ì—ì„œ ì‚¬ìš©
* ë“±ë¡ ìœ„ì¹˜: `beanFactory.addBeanPostProcessor(...)` (ApplicationContext ì´ˆê¸°í™” ì‹œ ìë™ íƒìƒ‰)

---

### âœ… 3. ìƒëª…ì£¼ê¸° ë‹¨ê³„ì—ì„œì˜ ì—­í•  ë¶„ë‹´

| ë‹¨ê³„                           | BeanDefinition                 | BeanPostProcessor                      |
| ---------------------------- | ------------------------------ | -------------------------------------- |
| 1. í´ë˜ìŠ¤ íƒìƒ‰                    | ë“±ë¡ë¨ (`ComponentScan`)          | -                                      |
| 2. BeanDefinition ìƒì„±         | ìŠ¤í”„ë§ì´ íŒŒì‹±í•˜ì—¬ ë“±ë¡                   | -                                      |
| 3. ì¸ìŠ¤í„´ìŠ¤ ìƒì„±                   | `beanClass.newInstance()`      | -                                      |
| 4. ì˜ì¡´ì„± ì£¼ì…                    | constructorArgs, properties ì„¤ì • | -                                      |
| 5. ì´ˆê¸°í™” ì „                     | -                              | `postProcessBeforeInitialization()` í˜¸ì¶œ |
| 6. ì´ˆê¸°í™” (ì˜ˆ: `@PostConstruct`) | -                              | -                                      |
| 7. ì´ˆê¸°í™” í›„                     | -                              | `postProcessAfterInitialization()` í˜¸ì¶œ  |
| 8. ìµœì¢… ë“±ë¡                     | -                              | í”„ë¡ì‹œ, ë˜í•‘ í›„ ê°ì²´ ì»¨í…Œì´ë„ˆ ë“±ë¡                   |

---

### âœ… 4. ë‚´ë¶€ í˜¸ì¶œ íë¦„ êµ¬ì¡°

```text
[BeanDefinitionRegistryPostProcessor]
    â†“
[BeanDefinition ë“±ë¡] â† XML, @Bean, @Component ë“±
    â†“
[BeanFactoryPostProcessor]
    â†“
[Bean ì¸ìŠ¤í„´ìŠ¤ ìƒì„±] â† createBean()
    â”œâ”€ populateBean() â†’ ì˜ì¡´ì„± ì£¼ì…
    â”œâ”€ applyBeanPostProcessorsBeforeInitialization()
    â”œâ”€ invokeInitMethods()
    â””â”€ applyBeanPostProcessorsAfterInitialization()
        â””â”€ í”„ë¡ì‹œ, ë˜í•‘ ë“±
```

---

### âœ… 5. í˜‘ì—… êµ¬ì¡° ì˜ˆì‹œ: AOP ì ìš© íë¦„

```java
@Configuration
@EnableAspectJAutoProxy
public class AppConfig {}
```

* AOPëŠ” ë‚´ë¶€ì ìœ¼ë¡œ `AnnotationAwareAspectJAutoProxyCreator` ë¥¼ BeanPostProcessorë¡œ ë“±ë¡
* postProcessAfterInitialization()ì—ì„œ í”„ë¡ì‹œ ê°ì²´ë¡œ ë˜í•‘

```java
@Override
public Object postProcessAfterInitialization(Object bean, String beanName) {
    if (shouldWrapWithProxy(bean)) {
        return createAopProxy(bean);
    }
    return bean;
}
```

* AOP í”„ë¡ì‹œëŠ” ì˜¤ì§ **BeanDefinition ê¸°ë°˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ëœ í›„**ì— ì ìš©ë˜ë¯€ë¡œ,
  ë‘˜ì€ í™•ì‹¤í•˜ê²Œ \*\*Bean ìƒì„± ì´ì „(ì •ì˜)ê³¼ ì´í›„(í›„ì²˜ë¦¬)\*\*ì˜ ì±…ì„ì„ ë¶„ë‹´

---

### âœ… 6. ìš”ì•½

| ê°œë…       | BeanDefinition                             | BeanPostProcessor                                               |
| -------- | ------------------------------------------ | --------------------------------------------------------------- |
| ì–¸ì œ ë™ì‘    | ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” ì‹œ (`refresh()` ì´ˆê¸°)                | Bean ìƒì„± ì‹œ (`getBean()` í˜¸ì¶œ ì‹œì )                                   |
| ì—­í•        | Bean ì •ì˜ ë©”íƒ€ì •ë³´ ì €ì¥ ë° ë“±ë¡                       | Bean ì¸ìŠ¤í„´ìŠ¤ í›„ì²˜ë¦¬                                                   |
| ê´€ë ¨ ì¸í„°í˜ì´ìŠ¤ | `BeanDefinition`, `BeanDefinitionRegistry` | `BeanPostProcessor`, `SmartInstantiationAwareBeanPostProcessor` |
| ì‚¬ìš© ì˜ˆ     | ìŠ¤ì½”í”„, ìƒì„±ì ì¸ì, í”„ë¡œí¼í‹° ì„¤ì •                       | AOP, í”„ë¡ì‹œ, Validation, DI ìµœì¢… ì»¤ìŠ¤í„°ë§ˆì´ì§•                              |

